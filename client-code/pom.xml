name: Sync Client POM (Dry Run)

on:
  workflow_dispatch:

jobs:
  sync-client-pom:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Debug repo structure
        run: |
          echo "Repo structure:"
          ls -R

      - name: Show first lines of both POMs
        run: |
          echo "===== Parent POM ====="
          head -n 15 pom.xml
          echo "===== Client POM ====="
          head -n 15 client-code/pom.xml

      - name: Extract values from parent POM
        id: parent
        run: |
          PARENT_GROUP_ID=$(xmlstarlet sel -N x="http://maven.apache.org/POM/4.0.0" \
            -t -v "/x:project/x:groupId" pom.xml)
          PARENT_ARTIFACT_ID=$(xmlstarlet sel -N x="http://maven.apache.org/POM/4.0.0" \
            -t -v "/x:project/x:artifactId" pom.xml)
          PARENT_VERSION=$(xmlstarlet sel -N x="http://maven.apache.org/POM/4.0.0" \
            -t -v "/x:project/x:version" pom.xml)

          echo "groupId=$PARENT_GROUP_ID" >> $GITHUB_OUTPUT
          echo "artifactId=$PARENT_ARTIFACT_ID" >> $GITHUB_OUTPUT
          echo "version=$PARENT_VERSION" >> $GITHUB_OUTPUT

      - name: Print parent values
        run: |
          echo "GroupId: ${{ steps.parent.outputs.groupId }}"
          echo "ArtifactId: ${{ steps.parent.outputs.artifactId }}"
          echo "Version: ${{ steps.parent.outputs.version }}"

      - name: Show full updated client POM
        run: |
          xmlstarlet ed -N x="http://maven.apache.org/PO
